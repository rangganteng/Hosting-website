<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <title>BPPD Sidoarjo - Management System</title>
    <link rel="stylesheet" href="werr.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>

    <div id="loginPage" class="page" style="display: flex;">
        <div class="login-box">
            <h2 style="color:white;">BPPD SIDOARJO</h2>
            <form onsubmit="doLogin(event)">
                <div class="input-group"><input type="text" placeholder="Username" required></div>
                <div class="input-group"><input type="password" placeholder="Password" required></div>
                <button type="submit" style="width:100%; padding:12px; background:white; color:#0b1a3d; border:none; border-radius:25px; font-weight:bold; cursor:pointer;">MASUK</button>
            </form>
        </div>
    </div>

    <div id="mainPage" class="page">
        <nav>
            <div style="font-weight:bold; color:#0b1a3d; font-size: 1.4rem;">BPPD SIDOARJO</div>
            <ul class="nav-links">
                <li><a onclick="updateChart('Hotel', 'bulanan')" class="btn-nav">Beranda</a></li>
                <li class="dropdown">
                    <a class="btn-nav">Statistik Pajak ‚ñΩ</a>
                    <div class="dropdown-content" id="taxMenu"></div>
                </li>
                <li><a onclick="toggleModal('inputModal')" class="btn-nav">‚úçÔ∏è Input Data Manual</a></li>
                <li><a onclick="alert('Laporan diunduh')" class="btn-nav">üì• Unduh Laporan</a></li>
                <li><a onclick="location.reload()" style="color:#d9534f; font-weight:bold; cursor:pointer; margin-left:10px;">Logout</a></li>
            </ul>
        </nav>

        <div class="container">
            <div class="kpi-container">
                <div class="kpi-card" style="background: #0b1a3d;">
                    <div style="display: flex; justify-content: center; align-items: center; gap: 5px; margin-bottom: 5px;">
                        <p style="font-size: 12px; opacity: 0.9;">Realisasi Tahunan</p>
                        <span id="txt-tahun-sel" style="font-size: 12px; font-weight: bold; color: #f39c12;"></span>
                        <select onchange="updateKpiTahun(this.value)">
                            <option value="" disabled selected>Pilih</option>
                            <option value="2021">2021</option><option value="2022">2022</option>
                            <option value="2023">2023</option><option value="2024">2024</option>
                            <option value="2025">2025</option>
                        </select>
                    </div>
                    <h2 id="val-tahun">Rp 0 M</h2>
                </div>

                <div class="kpi-card" style="background: #1e3a8a;">
                    <div style="display: flex; justify-content: center; align-items: center; gap: 5px; margin-bottom: 5px;">
                        <p style="font-size: 12px; opacity: 0.9;">Realisasi Bulanan</p>
                        <span id="txt-bulan-sel" style="font-size: 12px; font-weight: bold; color: #f39c12;"></span>
                        <select onchange="updateKpiBulan(this.value)">
                            <option value="" disabled selected>Pilih</option>
                            <option value="Jan">Januari</option><option value="Feb">Februari</option>
                            <option value="Mar">Maret</option><option value="Apr">April</option>
                            <option value="Mei">Mei</option><option value="Jun">Juni</option>
                            <option value="Jul">Juli</option><option value="Agu">Agustus</option>
                            <option value="Sep">September</option><option value="Okt">Oktober</option>
                            <option value="Nov">November</option><option value="Des">Desember</option>
                        </select>
                    </div>
                    <h2 id="val-bulan">Rp 0 M</h2>
                </div>

                <div class="kpi-card" style="background: #28a745;"><h3>Pencapaian</h3><h2 id="val-capai">90.4%</h2></div>
                <div class="kpi-card" style="background: #f39c12;"><h3 id="label-jenis">Pajak Hotel</h3><h2 id="val-jenis">Rp 0 M</h2></div>
            </div>

            <h3 id="chart-title" style="margin-bottom:20px; color:#0b1a3d;">Statistik Pajak</h3>
            <div class="chart-box"><canvas id="mainChart"></canvas></div>
        </div>
    </div>

    <div id="inputModal" class="modal">
        <div class="modal-content">
            <h3 style="margin-bottom:20px; text-align:center;">Input Realisasi</h3>
            <input type="number" id="inpNilai" placeholder="Masukkan Nilai (Rp)" style="width:100%; padding:10px; margin-bottom:15px; border-radius:8px; border:1px solid #ddd;">
            <button onclick="saveData()" style="width:100%; padding:12px; background:#0b1a3d; color:white; border:none; border-radius:8px; cursor:pointer;">SIMPAN</button>
            <p onclick="toggleModal('inputModal')" style="text-align:center; color:red; margin-top:15px; cursor:pointer; font-size:12px;">Batalkan</p>
        </div>
    </div>

    <script>
        const taxes = [
            {n: 'Hotel', i: 'üè®'}, {n: 'Resto', i: 'üç¥'}, {n: 'Hiburan', i: 'üé≠'}, {n: 'Reklame', i: 'üì¢'},
            {n: 'PLN', i: '‚ö°'}, {n: 'Parkir', i: 'üÖøÔ∏è'}, {n: 'Air Tanah', i: 'üíß'}, {n: 'BPHTB', i: 'üìú'},
            {n: 'PBB', i: 'üè°'}, {n: 'PKB', i: 'üöó'}, {n: 'BBNKB', i: 'üìã'}, {n: 'PT Pos', i: 'üìÆ'}
        ];

        function doLogin(e) {
            e.preventDefault();
            document.getElementById('loginPage').style.display = 'none';
            document.getElementById('mainPage').style.display = 'block';
            updateChart('Hotel', 'bulanan');
        }

        // Dropdown Sub-menu Render
        document.getElementById('taxMenu').innerHTML = taxes.map(t => `
            <div class="nested-dropdown">
                <a>${t.i} ${t.n} <span>‚ñ∂</span></a>
                <div class="nested-content">
                    <a onclick="updateChart('${t.n}', 'bulanan')">Bulanan</a>
                    <a onclick="updateChart('${t.n}', 'tahunan')">Tahunan</a>
                    <a onclick="updateChart('${t.n}', 'jenis')">Realisasi Jenis</a>
                </div>
            </div>`).join('');

        function updateKpiTahun(v) {
            document.getElementById('txt-tahun-sel').innerText = v;
            document.getElementById('val-tahun').innerText = `Rp ${(Math.random()*40+10).toFixed(1)} M`;
        }

        function updateKpiBulan(v) {
            document.getElementById('txt-bulan-sel').innerText = v;
            document.getElementById('val-bulan').innerText = `Rp ${(Math.random()*5+1).toFixed(1)} M`;
        }

        function updateChart(jenis, periode) {
            const ctx = document.getElementById('mainChart').getContext('2d');
            if(Chart.getChart('mainChart')) Chart.getChart('mainChart').destroy();
            document.getElementById('chart-title').innerText = `Statistik Pajak ${jenis} (${periode})`;
            document.getElementById('label-jenis').innerText = `Pajak ${jenis}`;
            
            const labels = periode === 'tahunan' ? ['2021','2022','2023','2024','2025'] : ['Jan','Feb','Mar','Apr','Mei','Jun'];
            const dataVal = labels.map(() => Math.floor(Math.random()*30)+10);
            document.getElementById('val-jenis').innerText = `Rp ${Math.floor(Math.random()*30)+10} M`;

            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{ label: 'Realisasi (M)', data: dataVal, backgroundColor: '#0b1a3d', borderRadius: 5 }]
                },
                options: { responsive: true, maintainAspectRatio: false }
            });
        }

        function toggleModal(id) {
            const m = document.getElementById(id);
            m.style.display = m.style.display === 'flex' ? 'none' : 'flex';
        }

        function saveData() {
            alert('Data Berhasil Disimpan!');
            toggleModal('inputModal');
        }
    </script>
</body>
</html>